# 使用对象进行设计       

## 引言     
当你使用软件产品时，你期望它能按照广告所宣传的那样运行。不幸的是，并非所有产品都能达到预期。问题在于，当许多产品被生产出来时，大部分时间和努力都投入到了工程阶段，而不是设计阶段。      

面向对象（OO）设计被誉为一种强大而灵活的软件开发方法。事实是，你可以轻易地创建好的和不好的OO设计，就像你可以创建好的和不好的非OO设计一样。不要因为你正在使用最先进的设计方法学就陷入一种错误的安全感。你必须关注整体设计，并投入适当的时间和精力来创建尽可能好的产品。      

在第5章“类设计指南”中，我们专注于设计好的类。本章重点是设计好的系统。一个系统可以被定义为相互作用的类。适当的设计实践在软件开发的历史中已经演变，你没有理由不利用你的软件前辈们的血汗和泪水，无论他们是否使用了 OO 技术。   

利用以往的努力不仅限于设计实践；你甚至可以在你的面向对象设计中整合现有的遗留代码。在许多情况下，你可以取用可能已经运行良好多年的代码，并直接将其包装在你的对象中。这种包装将在本章后面讨论。            

## 设计指南
`一个误区是认为存在一种真正的（最佳的）设计方法论`。这显然不是事实。没有正确或错误的方式来创建设计。如今，有许多设计方法可用，它们都有自己的支持者。然而，主要问题不在于使用哪种设计方法，而在于是否根本使用一种方法。这可以扩展到整个软件开发过程之外。一些组织没有遵循标准的软件开发流程，或者他们有一个流程但不坚持使用。创建良好设计的最重要因素是找到一个你和你的组织感到舒适的流程，坚持使用它，并不断完善它。实施一个没有人会遵循的设计流程是没有意义的。            

大多数涉及面向对象技术的书籍都提供了设计系统的非常相似的策略。实际上，除了一些特定于面向对象的问题之外，许多策略也适用于非 OO系统。      
`通常，一个稳固的OO设计过程包括以下步骤`：            
1. 进行适当的分析           
2. 制定描述系统的工作说明书         
3. 从这个工作说明书中收集需求           
4. 开发用户界面的原型           
5. 确定类           
6. 确定每个类的责任         
7. 确定各种类如何相互作用           
8. 创建描述待建系统的高层模型           

对于面向对象开发来说，高层系统模型特别重要。系统或对象模型由类图和类交互组成。这个模型应该忠实地代表系统，并且易于理解和修改。我们还需要一种模型的符号系统。这就是统一建模语言（UML）的用武之地。如你所知，UML不是一种设计过程，而是一种建模工具。在本书中，我只使用UML中的类图。我喜欢使用类图作为一种视觉工具来协助设计过程以及文档记录——即使我不使用其他可用的UML工具。      

>注意：`持续的设计过程`, 尽管有最好的意图和计划，在除最简单的情况外，设计是一个持续的过程。即使产品处于测试阶段，也会出现设计更改。项目经理需要划定界限，说明何时停止更改产品和增加功能。我喜欢称这为版本1。        

重要的是要理解有许多设计方法可用。一种早期的方法论称为瀑布模型，它主张在各个阶段之间设立严格的界限。在这种情况下，设计阶段在实现阶段之前完成，实现阶段在测试阶段之前完成，依此类推。实践中，瀑布模型被发现是不切实际的。目前，其他设计模型，如快速原型、极限编程、敏捷、Scrum等，推动了真正的迭代过程。在这些模型中，某些实现是在完成设计阶段之前尝试的，作为一种概念验证。尽管最近对瀑布模型有所回避，但该模型背后的目标是可以理解的。在开始编码之前制定一个完整且彻底的设计是一种健全的做法。你不会想在产品发布阶段再次决定迭代设计阶段。跨阶段迭代是不可避免的；然而，你应该将这些迭代减少到最少（见图6.1）。            

![dwo01](images/dwo01.png)  
图6.1       

简单来说，早期确定需求和将设计变更保持在最小的原因如下：        
* 设计阶段的需求/设计变更成本相对较小。     
* 实施阶段的设计变更成本显著更高。          
* 部署阶段后的设计变更成本与第一项相比简直是天文数字。          

同样地，你也不会希望在建筑设计完成之前就开始建造你梦想中的房子。如果我说金门大桥或帝国大厦的建造没有考虑任何设计问题，你会认为这种说法绝对是疯狂的。然而，如果我告诉你，你正在使用的软件可能包含一些设计缺陷，实际上可能没有经过彻底测试，你可能不会觉得这很疯狂。          

事实上，可能无法彻底测试软件，意味着绝对不存在任何错误。然而，从理论上讲，这始终是目标。我们应该始终尝试消除尽可能多的错误。桥梁和软件可能不是直接可比的；然而，软件必须追求与桥梁建设等“更硬”的工程学科相同的工程卓越水平。劣质软件可能是致命的——它不仅仅是工资单上的错误数字。例如，医疗设备中的劣质软件可以杀死和致残人。然而，你可能愿意接受偶尔重启计算机。但对于桥梁的失败不能这么说。            

>注意：`安全与经济`，你会愿意走过一座没有经过检查和测试的桥梁吗？不幸的是，对于许多软件包，用户不得不承担大部分测试的责任。这对用户和软件提供商来说都非常昂贵。不幸的是，短期经济利益似乎常常是项目决策的主要因素。         

因为客户似乎只愿意支付有限的价格并忍受质量差的软件，一些软件提供商发现从长远来看，让客户测试产品比自己做测试更便宜。从短期来看这可能是真的，但从长远来看，其成本远超软件提供商的预期。最终，软件提供商的声誉将受到损害。            

一些计算机软件公司愿意使用beta测试阶段让客户进行测试——理论上，这些测试应该在beta版本到达客户手中之前就完成。许多客户愿意冒险使用尚未发布的软件，因为他们急于获取产品承诺的功能。相反，一些客户像躲避瘟疫一样抵制新版本。如果它运行正常，就不要修复它。升级可能是一场噩梦！          

软件发布后，未能在发布前发现并修复的问题将变得更加昂贵。举个例子，考虑汽车公司面临召回的困境。如果在汽车发货前（理想情况下是在制造前）发现并修复了一个缺陷，那么成本将比所有已交付的汽车都必须被一一召回和修复要便宜得多。这种情况不仅非常昂贵，还会损害公司的声誉。在日益竞争激烈的市场中，高质量的软件、支持服务和声誉是竞争优势（见图6.2）。         

![dwo02](images/dwo02.png)      

以下部分提供了之前列出的设计过程中各项内容的简要概述。在本章的后面部分，我们将通过一个例子，更详细地解释这些内容。      

