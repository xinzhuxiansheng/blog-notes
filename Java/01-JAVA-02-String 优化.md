# Java String 优化 

## 字符串优化
随着Java平台的发展，它对编程中最普遍的构造之一：字符串的处理方式也在不断演变。鉴于字符串是几乎每个Java应用程序的基本方面，在这一领域的任何改进都能显著影响应用程序的速度、内存占用和可扩展性。认识到这一关系，Java社区在字符串优化方面投入了大量精力。本节重点介绍了在不同Java版本中引入的四个重要优化：        

    字面量和驻留字符串优化：这种优化涉及“字符串池”的管理，以减少堆占用，从而提高内存利用率。
    G1中的字符串去重：G1垃圾收集器提供的去重功能旨在通过去重相同的String对象来减少堆占用。
    字符串连接的Indy化：我们将研究字符串连接在字节码级别的管理方式变化，这种变化提高了性能并增加了灵活性。
    紧凑字符串：我们将探讨从char[]到byte[]作为字符串的底层数组这一转变，如何能减少应用程序的内存占用，将ASCII文本的空间需求减半。

每种优化不仅带来独特的优势，还带来了各自的一系列考量和注意事项。在探讨这些领域时，我们的目标是理解它们的技术方面以及它们对应用程序性能的实际影响。   

HotSpot VM中的字面量和驻留字符串优化

减少Java中的分配占用一直是增强性能的重要机会。早在Java 9引入将字符串的底层数组从char[]转换为byte[]之前，OpenJDK HotSpot VM就已经采用了技术来最小化内存使用，特别是针对字符串。

一个主要的优化涉及“字符串池”。鉴于字符串是不可变的，并且在应用程序的各个部分中经常被重复使用，Java中的String类利用一个池来节省堆空间。当调用String.intern()方法时，它会检查池中是否已有一个相同的字符串。如果有，该方法返回对已存在字符串的引用，而不是分配一个新的对象。

考虑一个实例String1，在Java 9之前，它会有一个String1对象和一个底层的char[]数组（如图7.1所示）。

调用String1.intern()会检查池中是否有一个具有相同值的字符串。如果没有找到，则将String1添加到池中（如图7.2所示）。

图7.3描绘了字符串驻留之前的情况。当一个新的字符串String2被创建并驻留，并且它等于String1时，它将引用池中相同的char[]（如图7.4所示）。    

