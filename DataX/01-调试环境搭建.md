## 调试环境搭建         

### clone 源码  
```shell
git clone git@github.com:alibaba/DataX.git  
```

### 导入Idea 编译、打包 
```shell
# 项目编译
mvn clean package -Dmaven.test.skip=true 

# 若需要打包成可执行包，执行以下命令
mvn -U clean package assembly:assembly -Dmaven.test.skip=true
```

### 安装 python
启动脚本依赖 python  

### 配置Debug环境   
参考 userGuid.md, DataX是使用 python datax.py xxxx的命令启动的， 为了在Idea中调试 datax，我们需要从 datax.py启动脚本中打印 完整的启动命令（包括参数）。 为了知晓，请参考以下几个步骤：  
1.修改 datax.py 脚本在 235行 添加`print('startCommand : ' + startCommand)`打印启动命令      
2.使用`mvn -U clean package assembly:assembly -Dmaven.test.skip=true` datax源码编译打包成可执行程序     
3.修改 打包后的 datax/conf/core.json 中关于 `byte` 参数，将 -1 改成 2000000 即可           
```json
"transport": {
    "channel": {
        "class": "com.alibaba.datax.core.transport.channel.memory.MemoryChannel",
        "speed": {
            "byte": 2000000, // 修改地方        
            "record": -1
        },
        "flowControlInterval": 20,
        "capacity": 512,
        "byteCapacity": 67108864
    },
    "exchanger": {
        "class": "com.alibaba.datax.core.plugin.BufferedRecordExchanger",
        "bufferSize": 32
    }
},
```
4.准备测试用例，`python /path/to/datax/bin/datax.py /path/to/your/job/config.json` 启动 datax           
```json
{
    "job": {
        "setting": {
            "speed": {
                "byte": 1048576
            }
        },
        "content": [
            {
                "reader": {
                    "name": "txtfilereader",
                    "parameter": {
                        "path": ["/Users/a/Code/Java/DataX/TMP/source.txt"],
                        "encoding": "UTF-8",
                        "fieldDelimiter": ","
                    }
                },
                "writer": {
                    "name": "txtfilewriter",
                    "parameter": {
                        "path": "/Users/a/Code/Java/DataX/TMP",
                        "fileName": "target",
                        "writeMode": "truncate",
                        "encoding": "UTF-8",
                        "fieldDelimiter": ","
                    }
                }
            }
        ]
    }
}
```

5.查看data.py 打印的启动命令：  
```
startCommand : java -server -Xms1g -Xmx1g -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/Users/a/Code/Java/DataX/TMP/datax/log -Xms1g -Xmx1g -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/Users/a/Code/Java/DataX/TMP/datax/log -Dloglevel=info -Dfile.encoding=UTF-8 -Dlogback.statusListenerClass=ch.qos.logback.core.status.NopStatusListener -Djava.security.egd=file:///dev/urandom -Ddatax.home=/Users/a/Code/Java/DataX/TMP/datax -Dlogback.configurationFile=/Users/a/Code/Java/DataX/TMP/datax/conf/logback.xml -classpath /Users/a/Code/Java/DataX/TMP/datax/lib/*:.  -Dlog.file.name=ataX_TMP_config_json com.alibaba.datax.core.Engine -mode standalone -jobid -1 -job /Users/a/Code/Java/DataX/TMP/config.json     
```

6.根据启动命令配置 Idea 调试    
如何配置启动：  
![debug01](images/debug01.png)          


### 执行 com.alibaba.datax.core.Engine 启动类           
调试 Engine#main()方法即可。           

refer       
1.https://github.com/alibaba/DataX/blob/master/userGuid.md              
2.https://www.cnblogs.com/xujq/p/16953054.html                          

