## 分布式系统的挑战         

### 引言    
分布式系统领域的传奇任务 Leslie Lamport 曾指出：    
分布式系统是指一台你根本不知道其存在的计算机发生了故障，会导致你自己的计算机无法使用。（A distributed system is one in which the failure of a computer you didn't event know existed can render your own computer unusable.）       

刚接触分布式系统的开发者，都会根据自己在单机系统上的惊艳，做出一些假设来进行分布式的设计，构建和验证，结果就碰到许多人不知所措的问题。      

在20世纪90年代，L.Peter Deutsch 等人收到 Sun Microsystems 公司内部发生的问题的启示，总结出了分布式计算的缪误，这些缪误如下：    
1）网络是可靠的 
2）延迟为0  
3）带宽是无限的 
4）网络是安全的 
5）拓扑结构不会改变 
6）单一管理员   
7）传输成本为0  
8）网络是同构的     
其中任何一个缪误都可能导致软件产生严重的问题，在设计和开发软件时，开发者应该仔细考虑这些缪误，丢弃单体应用的思考模式。          
Leslie Lamport 的话和分布式计算的缪误都表明了，分布式系统充满了挑战，构建分布式应用不会一帆风顺。我们将重点讨论下面3个问题：        

### 网络延迟问题        
分布式系统中的多个节点通过网络进行通信,但网络并不能保证数据什么时候到达，以及是否一定到达,有时网络甚至是不安全的。这就导致很多反直觉行为的产生，而这些行为在单机系统中并不会出现。      

例如，分布式系统中的消息传递可能出现以下问题:           
* 消息丢失了。
* 我们可能认为请求丢失了,但实际上消息只是延迟到达。 
* 网络可能会重传消息，导致收到重复的消息。      
* 消息延迟可能会让我们认为某个服务已经因故障下线，但实际上并没有。  
* 消息可能以不同的顺序到达，或者不同的节点上消息到达的顺序不同。        

这些因素都会影响我们设计分布式系统。也许 TCP 这样封装得很好的协议让开发者很容易相信网络是可靠的,但这只是一种错觉,我们应该明白,网络是建立在硬件之上的,这些硬件也会在某些时候出现故障。       

### 部分失效问题    
单机系统上的程序要么正常工作,要么彻底出错。     
但在分布式系统中，系统可能会有一部分节点正常工作,而另一部分节点停止运行，或者另一部分其实正常运行，但由于网络中断导致无法协同工作。系统的某些部分可能会以某种不可预知的方式宕机，这被称为部分失效 (Partial Failure)。       

难点在于部分失效是不确定的:如果你试图做任何涉及多个节点和网络的事情,那么它有时可能会工作，有时可能会出现不可预知的失败。正如我们将要在后续章节中看到的，你甚至不知道应用程序是否成功了,因为消息通过网络传播的时间也是不确定的。 

这种不确定性和部分失效的可能性，使得分布式系统难以捉摸和调试。尤其当你的操作需要原子性时--要么在所有节点都成功,要么在所有节点都失败。在这种情况下，部分失效就会带来很大的复杂性和挑战,甚至严重影响系统的性能。          

### 时钟问题    
在单机系统中，每个进程都有一个共同的时间,可以通过这个时间来调度进程从而表现出同步行为。而在分布式系统中,每台机器都有自己的时钟,各个物理设备的本地时钟走时并不准确，可能比其他机器稍快或更慢。       

另外,消息通过网络从一台机器传送到另一台机器也需要时间,但由于网络中的可变延迟,我们不知道消息传递到底花了多少时间。这个事实让我们很难确定在涉及多台机器时事件发生的顺序。     

处理这个问题的一种常见的方式是，使用一个时间服务器来同步时间,但这仍不足以解决网络可变延迟的问题,同步后的时间也未必精准。另一种解决方法,像是 Google 构建的 TrueTimeAPI!,使应用能够生成单调递增的时间戳,但这通常需要较为昂贵的原子钟设备和精心设计的系统。更普遍的方式是 Leslie Lamport 提出的`使用逻辑时钟来确定时间顺序,并引出了分布式系统中的状态机`。                   


refer   
1.《深入理解分布式系统》            
