**正文**


## offset提交

在消费者消费消息的过程中 ，提交offset的时机显得非常重要，因为它决定了消费者故障重启后的消费位置；
在开发中我们通过将 enable.auto.commit选项设置为true可以起到自动提交offset的功能，auto.commit.interval.ms选项则设置了自动提交的时间间隔，这是最简单的提交offset方式。每次在调用KafkaConsumer.poll()方法时都会检测是否需要自动提交，并提交上次poll()方法返回的最后一个消息的offset。为了避免消息丢失，建议poll()方法之前要处理完上次poll方法拉取的全部消息。


要想实现"Exactly once" 语义
1. 每个分区只有一个生产者写入消息，当出现异常或超时的情况时，生产者就要查询此分区的最后一个消息，用来决定后序操作是消息重传还是继续发送
2. 为诶个消息添加一个全局唯一逐渐，生产者不做其他特殊处理，按照之前分析方式进行重传，由消费者对消息进行去重，实现"Exactly once" 语义

